<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è ‚Ä¢ Easy Business</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --accent-color: #fbbf24;
      --success-color: #10b981;
      --error-color: #ef4444;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --bg-card: #ffffff;
      --bg-input: #f3f4f6;
      --radius: 16px;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    }

    /* Dark Mode Variables */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-card: #1f2937;
        --bg-input: #374151;
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
      }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--primary-gradient);
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
      color: var(--text-primary);
    }

    /* –§–æ–Ω–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 30L15 0H45L30 30Z' fill='%23ffffff' fill-opacity='0.05'/%3E%3C/svg%3E");
      z-index: -1;
    }

    .container {
      width: 100%;
      max-width: 450px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .logo {
      text-align: center;
      font-size: 28px;
      font-weight: 800;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .logo span {
      color: var(--accent-color);
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      width: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 8px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header p {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
    .input-group {
      position: relative;
      margin-bottom: 16px;
    }

    .input-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 18px;
    }

    .input-field {
      width: 100%;
      height: 56px;
      padding: 0 52px;
      border: 2px solid transparent;
      border-radius: 12px;
      background: var(--bg-input);
      color: var(--text-primary);
      font-size: 16px;
      transition: all 0.2s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: #667eea;
      background: var(--bg-card);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .toggle-password {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è */
    .password-strength {
      margin-bottom: 20px;
    }

    .strength-text {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
    }

    .strength-bar {
      height: 6px;
      background: var(--bg-input);
      border-radius: 10px;
      overflow: hidden;
    }

    .strength-fill {
      height: 100%;
      width: 0;
      transition: all 0.4s ease;
    }

    /* –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è */
    .password-requirements {
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .password-requirements h4 {
      font-size: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .requirements-list {
      list-style: none;
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .requirements-list li {
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
    }

    .requirement-icon {
      font-size: 10px;
    }

    .requirement-met {
      color: var(--success-color) !important;
    }

    /* –ö–Ω–æ–ø–∫–∞ */
    .button {
      width: 100%;
      height: 56px;
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .button:not(:disabled):active {
      transform: scale(0.98);
    }

    /* –°–µ–ª–µ–∫—Ç–æ—Ä —è–∑—ã–∫–∞ (–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π) */
    .language-selector {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 100;
    }

    .language-btn {
      background: white;
      border: none;
      padding: 10px 16px;
      border-radius: 50px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      cursor: pointer;
      color: #4b5563;
      transition: all 0.2s ease;
    }

    .language-btn:hover {
      background: #f9fafb;
      transform: translateY(-1px);
    }

    .language-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: var(--bg-card);
      border-radius: 12px;
      box-shadow: var(--shadow);
      display: none;
      overflow: hidden;
      min-width: 140px;
    }

    .language-dropdown.show {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    .language-option {
      padding: 12px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }

    .language-option:hover {
      background: var(--bg-input);
    }

    /* Footer */
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
    }

    .footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }

    /* –°–æ–æ–±—â–µ–Ω–∏—è */
    .result-message {
      margin-top: 16px;
      padding: 16px;
      border-radius: 12px;
      font-size: 14px;
      text-align: center;
    }
    .error { background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; }
    .success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }

    /* Desktop Styles */
    @media (min-width: 640px) {
      .card {
        padding: 40px;
      }
      .header h1 {
        font-size: 28px;
      }
      .requirements-list {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* Landscape mode fix */
    @media (max-height: 500px) {
      body { padding: 80px 16px 20px; }
      .language-selector { top: 10px; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body>
  <div class="language-selector">
    <button class="language-btn" id="languageToggle">
      <i class="fas fa-globe"></i>
      <span id="currentLanguage">–†—É—Å—Å–∫–∏–π</span>
      <i class="fas fa-chevron-down" style="font-size: 12px;"></i>
    </button>
    <div class="language-dropdown" id="languageDropdown">
      <div class="language-option active" data-lang="ru">–†—É—Å—Å–∫–∏–π</div>
      <div class="language-option" data-lang="en">English</div>
      <div class="language-option" data-lang="tr">T√ºrk√ße</div>
    </div>
  </div>

  <div class="container">
    <div class="logo">Easy<span>Business</span></div>
    
    <div class="card">
      <div class="header">
        <h1 id="title">–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h1>
        <p id="description">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏</p>
      </div>

      <div class="input-group">
        <i class="fas fa-lock input-icon"></i>
        <input type="password" id="password" class="input-field" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
        <button type="button" class="toggle-password" data-target="password">
          <i class="fas fa-eye"></i>
        </button>
      </div>

      <div class="input-group">
        <i class="fas fa-lock input-icon"></i>
        <input type="password" id="confirmPassword" class="input-field" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        <button type="button" class="toggle-password" data-target="confirmPassword">
          <i class="fas fa-eye"></i>
        </button>
      </div>

      <div class="password-strength">
        <span class="strength-text" id="strengthText">–°–ª–æ–∂–Ω–æ—Å—Ç—å: <span>...</span></span>
        <div class="strength-bar">
          <div class="strength-fill" id="strengthFill"></div>
        </div>
      </div>

      <div class="password-requirements">
        <h4 id="reqTitle"><i class="fas fa-shield-alt"></i> –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é</h4>
        <ul class="requirements-list">
          <li id="req-length"><i class="fas fa-circle requirement-icon"></i> <span>8+ —Å–∏–º–≤–æ–ª–æ–≤</span></li>
          <li id="req-latin"><i class="fas fa-circle requirement-icon"></i> <span>–õ–∞—Ç–∏–Ω–∏—Ü–∞</span></li>
          <li id="req-number"><i class="fas fa-circle requirement-icon"></i> <span>–¶–∏—Ñ—Ä—ã</span></li>
          <li id="req-special"><i class="fas fa-circle requirement-icon"></i> <span>–°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã</span></li>
        </ul>
      </div>

      <button id="submitBtn" class="button">
        <span id="buttonText">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</span>
        <div class="spinner" id="spinner" style="display: none;"></div>
      </button>

      <div id="resultMessage"></div>

      <div class="footer">
        <p id="footerText">–í—Å–ø–æ–º–Ω–∏–ª–∏ –ø–∞—Ä–æ–ª—å? <a href="#" id="loginLink">–í–æ–π—Ç–∏</a></p>
      </div>
    </div>
  </div>

  <script>
    // –¢–µ –∂–µ —Å–∞–º—ã–µ —Ç–µ–∫—Å—Ç—ã, —á—Ç–æ –∏ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ
    const texts = {
      ru: {
        title: "–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è",
        description: "–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å",
        passwordPlaceholder: "–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å",
        confirmPlaceholder: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å",
        buttonText: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å",
        strengthText: "–°–ª–æ–∂–Ω–æ—Å—Ç—å: ",
        strengthLevels: ["–æ—á–µ–Ω—å —Å–ª–∞–±—ã–π", "—Å–ª–∞–±—ã–π", "—Å—Ä–µ–¥–Ω–∏–π", "—Å–∏–ª—å–Ω—ã–π", "–æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π"],
        success: "üéâ –£—Å–ø–µ—à–Ω–æ!",
        successMessage: "–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω. –ú–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.",
        errorToken: "üö´ –°—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞",
        errorNetwork: "‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–µ—Ç–∏",
        errorMatch: "üîí –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç",
        errorWeak: "‚ö†Ô∏è –ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã–π",
        loginLink: "–í–æ–π—Ç–∏",
        footerText: "–í—Å–ø–æ–º–Ω–∏–ª–∏ –ø–∞—Ä–æ–ª—å? ",
        reqTitle: "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é",
        reqLength: "8+ —Å–∏–º–≤–æ–ª–æ–≤",
        reqLatin: "–õ–∞—Ç–∏–Ω–∏—Ü–∞",
        reqNumber: "–¶–∏—Ñ—Ä—ã",
        reqSpecial: "–°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã"
      },
      en: {
        title: "Reset Password",
        description: "Create a new strong password",
        passwordPlaceholder: "New password",
        confirmPlaceholder: "Confirm password",
        buttonText: "Save Password",
        strengthText: "Strength: ",
        strengthLevels: ["very weak", "weak", "medium", "strong", "very strong"],
        success: "üéâ Success!",
        successMessage: "Password changed successfully.",
        errorToken: "üö´ Link invalid",
        errorNetwork: "‚ö†Ô∏è Network error",
        errorMatch: "üîí Passwords do not match",
        errorWeak: "‚ö†Ô∏è Password too weak",
        loginLink: "Log in",
        footerText: "Remembered? ",
        reqTitle: "Requirements",
        reqLength: "8+ characters",
        reqLatin: "Latin letters",
        reqNumber: "Numbers",
        reqSpecial: "Special symbols"
      },
      tr: {
        title: "≈ûifre Sƒ±fƒ±rlama",
        description: "Yeni g√º√ßl√º bir ≈üifre olu≈üturun",
        passwordPlaceholder: "Yeni ≈üifre",
        confirmPlaceholder: "≈ûifreyi onayla",
        buttonText: "Kaydet",
        strengthText: "G√º√ß: ",
        strengthLevels: ["√ßok zayƒ±f", "zayƒ±f", "orta", "g√º√ßl√º", "√ßok g√º√ßl√º"],
        success: "üéâ Ba≈üarƒ±lƒ±!",
        successMessage: "≈ûifreniz deƒüi≈ütirildi.",
        errorToken: "üö´ Baƒülantƒ± ge√ßersiz",
        errorNetwork: "‚ö†Ô∏è Aƒü hatasƒ±",
        errorMatch: "üîí ≈ûifreler e≈üle≈ümiyor",
        errorWeak: "‚ö†Ô∏è ≈ûifre gereksinimleri kar≈üƒ±lamƒ±yor",
        loginLink: "Giri≈ü yap",
        footerText: "Hatƒ±rladƒ±nƒ±z mƒ±? ",
        reqTitle: "Gereksinimler",
        reqLength: "8+ karakter",
        reqLatin: "Latin harf",
        reqNumber: "Rakam",
        reqSpecial: "√ñzel karakter"
      }
    };

    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    let currentLang = 'ru';

    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirmPassword');
    const submitBtn = document.getElementById('submitBtn');
    const buttonText = document.getElementById('buttonText');
    const spinner = document.getElementById('spinner');
    const resultMessage = document.getElementById('resultMessage');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞
    document.getElementById('languageToggle').onclick = (e) => {
      e.stopPropagation();
      document.getElementById('languageDropdown').classList.toggle('show');
    };

    document.querySelectorAll('.language-option').forEach(opt => {
      opt.onclick = () => {
        currentLang = opt.dataset.lang;
        updateLanguage();
        document.getElementById('languageDropdown').classList.remove('show');
      };
    });

    window.onclick = () => document.getElementById('languageDropdown').classList.remove('show');

    function updateLanguage() {
      const t = texts[currentLang];
      document.getElementById('title').innerText = t.title;
      document.getElementById('description').innerText = t.description;
      passwordInput.placeholder = t.passwordPlaceholder;
      confirmInput.placeholder = t.confirmPlaceholder;
      buttonText.innerText = t.buttonText;
      document.getElementById('currentLanguage').innerText = currentLang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : currentLang === 'en' ? 'English' : 'T√ºrk√ße';
      document.getElementById('loginLink').innerText = t.loginLink;
      document.getElementById('footerText').firstChild.textContent = t.footerText;
      document.getElementById('reqTitle').innerHTML = `<i class="fas fa-shield-alt"></i> ${t.reqTitle}`;
      document.getElementById('req-length').querySelector('span').innerText = t.reqLength;
      document.getElementById('req-latin').querySelector('span').innerText = t.reqLatin;
      document.getElementById('req-number').querySelector('span').innerText = t.reqNumber;
      document.getElementById('req-special').querySelector('span').innerText = t.reqSpecial;
      updatePasswordStrength();
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å
    document.querySelectorAll('.toggle-password').forEach(btn => {
      btn.onclick = () => {
        const input = document.getElementById(btn.dataset.target);
        input.type = input.type === 'password' ? 'text' : 'password';
        btn.innerHTML = `<i class="fas fa-${input.type === 'password' ? 'eye' : 'eye-slash'}"></i>`;
      };
    });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∏–ª–∞ –ø–∞—Ä–æ–ª—è
    passwordInput.oninput = () => {
      const val = passwordInput.value;
      const checks = {
        length: val.length >= 8,
        latin: /[a-zA-Z]/.test(val),
        number: /[0-9]/.test(val),
        special: /[^A-Za-z0-9]/.test(val)
      };

      let score = 0;
      Object.keys(checks).forEach(key => {
        const el = document.getElementById(`req-${key}`);
        if (checks[key]) {
          el.classList.add('requirement-met');
          el.querySelector('i').className = 'fas fa-check-circle requirement-icon';
          score++;
        } else {
          el.classList.remove('requirement-met');
          el.querySelector('i').className = 'fas fa-circle requirement-icon';
        }
      });

      const strength = (score / 4) * 100;
      strengthFill.style.width = strength + '%';
      strengthFill.style.background = strength < 50 ? '#ef4444' : strength < 100 ? '#fbbf24' : '#10b981';
      
      const level = Math.floor((score / 4) * (texts[currentLang].strengthLevels.length - 1));
      strengthText.innerHTML = `${texts[currentLang].strengthText} <span style="color:${strengthFill.style.background}">${texts[currentLang].strengthLevels[level]}</span>`;
      
      submitBtn.disabled = !(score === 4 && val === confirmInput.value);
    };

    confirmInput.oninput = passwordInput.oninput;

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    submitBtn.onclick = async () => {
      const t = texts[currentLang];
      buttonText.style.display = 'none';
      spinner.style.display = 'block';
      submitBtn.disabled = true;

      try {
        const res = await fetch('https://peewlvlbbiywjfjoawew.supabase.co/functions/v1/reset_password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBlZXdsdmxiYml5d2pmam9hd2V3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyODY1ODIsImV4cCI6MjA3Mzg2MjU4Mn0.bP7xwohBa5JOLT4_cQYz-nhprr6m6a43NUt-HcPCq8c'
          },
          body: JSON.stringify({ token, password: passwordInput.value })
        });

        if (res.ok) {
          resultMessage.className = 'result-message success';
          resultMessage.innerHTML = `<strong>${t.success}</strong><br>${t.successMessage}`;
          submitBtn.style.display = 'none';
        } else {
          const data = await res.json();
          throw new Error(data.error || t.errorToken);
        }
      } catch (err) {
        resultMessage.className = 'result-message error';
        resultMessage.innerText = err.message;
        buttonText.style.display = 'block';
        spinner.style.display = 'none';
        submitBtn.disabled = false;
      }
    };

    updateLanguage();
  </script>
</body>
</html>
