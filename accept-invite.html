<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Ä¢ Easy Business</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --accent-color: #fbbf24;
      --success-color: #10b981;
      --error-color: #ef4444;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --bg-card: #ffffff;
      --bg-input: #f3f4f6;
      --radius: 16px;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-card: #1f2937;
        --bg-input: #374151;
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
      }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--primary-gradient);
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
      color: var(--text-primary);
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 30L15 0H45L30 30Z' fill='%23ffffff' fill-opacity='0.05'/%3E%3C/svg%3E");
      z-index: -1;
    }

    .container {
      width: 100%;
      max-width: 450px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .logo {
      text-align: center;
      font-size: 28px;
      font-weight: 800;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .logo span { color: var(--accent-color); }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      width: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 12px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header p {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .input-group {
      position: relative;
      margin-bottom: 16px;
    }

    .input-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 18px;
    }

    .input-field {
      width: 100%;
      height: 56px;
      padding: 0 52px;
      border: 2px solid transparent;
      border-radius: 12px;
      background: var(--bg-input);
      color: var(--text-primary);
      font-size: 16px;
      transition: all 0.2s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: #667eea;
      background: var(--bg-card);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .toggle-password {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .password-strength {
      margin-bottom: 20px;
    }

    .strength-text {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
    }

    .strength-bar {
      height: 6px;
      background: var(--bg-input);
      border-radius: 10px;
      overflow: hidden;
    }

    .strength-fill {
      height: 100%;
      width: 0;
      transition: all 0.4s ease;
    }

    .password-requirements {
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .password-requirements h4 {
      font-size: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .requirements-list {
      list-style: none;
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .requirements-list li {
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
    }

    .requirement-met {
      color: var(--success-color) !important;
    }

    .button {
      width: 100%;
      height: 56px;
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .language-selector {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 100;
    }

    .language-btn {
      background: white;
      border: none;
      padding: 10px 16px;
      border-radius: 50px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      cursor: pointer;
      color: #4b5563;
    }

    .language-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: var(--bg-card);
      border-radius: 12px;
      box-shadow: var(--shadow);
      display: none;
      min-width: 140px;
      overflow: hidden;
    }

    .language-dropdown.show { display: block; animation: fadeIn 0.2s ease; }

    .language-option {
      padding: 12px 16px;
      cursor: pointer;
      font-size: 14px;
    }

    .language-option:hover { background: var(--bg-input); }

    .result-message {
      margin-top: 16px;
      padding: 20px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.6;
    }
    .error { background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; }
    .success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }

    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    @media (min-width: 640px) {
      .card { padding: 40px; }
      .requirements-list { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>

<body>
  <div class="language-selector">
    <button class="language-btn" id="languageToggle">
      <i class="fas fa-globe"></i>
      <span id="currentLanguage">–†—É—Å—Å–∫–∏–π</span>
      <i class="fas fa-chevron-down" style="font-size: 12px;"></i>
    </button>
    <div class="language-dropdown" id="languageDropdown">
      <div class="language-option" data-lang="ru">–†—É—Å—Å–∫–∏–π</div>
      <div class="language-option" data-lang="en">English</div>
      <div class="language-option" data-lang="tr">T√ºrk√ße</div>
    </div>
  </div>

  <div class="container">
    <div class="logo">Easy<span>Business</span></div>
    
    <div class="card">
      <div class="header">
        <h1 id="title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h1>
        <p id="description">–í—ã –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞.</p>
      </div>

      <div class="input-group">
        <i class="fas fa-lock input-icon"></i>
        <input type="password" id="password" class="input-field" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
        <button type="button" class="toggle-password" data-target="password">
          <i class="fas fa-eye"></i>
        </button>
      </div>

      <div class="input-group">
        <i class="fas fa-lock input-icon"></i>
        <input type="password" id="confirmPassword" class="input-field" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        <button type="button" class="toggle-password" data-target="confirmPassword">
          <i class="fas fa-eye"></i>
        </button>
      </div>

      <div class="password-strength">
        <span class="strength-text" id="strengthText">–°–ª–æ–∂–Ω–æ—Å—Ç—å: <span>...</span></span>
        <div class="strength-bar">
          <div class="strength-fill" id="strengthFill"></div>
        </div>
      </div>

      <div class="password-requirements">
        <h4 id="reqTitle"><i class="fas fa-shield-alt"></i> –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</h4>
        <ul class="requirements-list">
          <li id="req-length"><i class="fas fa-circle requirement-icon"></i> <span>8+ —Å–∏–º–≤–æ–ª–æ–≤</span></li>
          <li id="req-latin"><i class="fas fa-circle requirement-icon"></i> <span>–õ–∞—Ç–∏–Ω–∏—Ü–∞</span></li>
          <li id="req-number"><i class="fas fa-circle requirement-icon"></i> <span>–¶–∏—Ñ—Ä—ã</span></li>
          <li id="req-special"><i class="fas fa-circle requirement-icon"></i> <span>–°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã</span></li>
        </ul>
      </div>

      <button id="submitBtn" class="button">
        <span id="buttonText">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</span>
        <div class="spinner" id="spinner" style="display: none;"></div>
      </button>

      <div id="resultMessage"></div>
    </div>
  </div>

  <script>
    const texts = {
      ru: {
        title: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        description: "–í—ã –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É Easy Business –Ω–∞ —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.<br>–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ø—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –∏ –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ –Ω–∏–∂–µ.",
        passwordPlaceholder: "–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å",
        confirmPlaceholder: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å",
        buttonText: "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é",
        strengthText: "–°–ª–æ–∂–Ω–æ—Å—Ç—å: ",
        strengthLevels: ["–æ—á–µ–Ω—å —Å–ª–∞–±—ã–π", "—Å–ª–∞–±—ã–π", "—Å—Ä–µ–¥–Ω–∏–π", "—Å–∏–ª—å–Ω—ã–π", "–æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π"],
        welcome: "<strong>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Easy Business!</strong><br><br>–ê–∫–∫–∞—É–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Å–≤–æ–π email –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å.",
        errorToken: "üö´ –û—à–∏–±–∫–∞: —Å—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∏–ª–∏ –∏—Å—Ç–µ–∫–ª–∞.",
        errorMatch: "üîí –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç",
        reqTitle: "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é",
        reqLength: "8+ —Å–∏–º–≤–æ–ª–æ–≤", reqLatin: "–õ–∞—Ç–∏–Ω–∏—Ü–∞", reqNumber: "–¶–∏—Ñ—Ä—ã", reqSpecial: "–°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã"
      },
      en: {
        title: "Complete Registration",
        description: "You have been added to Easy Business as an administrator.<br>Create a password below to continue.",
        passwordPlaceholder: "New password",
        confirmPlaceholder: "Confirm password",
        buttonText: "Complete Registration",
        strengthText: "Strength: ",
        strengthLevels: ["very weak", "weak", "medium", "strong", "very strong"],
        welcome: "<strong>Welcome to Easy Business!</strong><br><br>Account confirmed. You can now log in using your email and the password you just created.",
        errorToken: "üö´ Error: invite link is invalid or expired.",
        errorMatch: "üîí Passwords do not match",
        reqTitle: "Password Requirements",
        reqLength: "8+ characters", reqLatin: "Latin letters", reqNumber: "Numbers", reqSpecial: "Special symbols"
      },
      tr: {
        title: "Kayƒ±t Onayƒ±",
        description: "Easy Business sistemine y√∂netici olarak eklendiniz.<br>Devam etmek i√ßin l√ºtfen bir ≈üifre belirleyin.",
        passwordPlaceholder: "Yeni ≈üifre",
        confirmPlaceholder: "≈ûifreyi onayla",
        buttonText: "Kaydƒ± Tamamla",
        strengthText: "G√º√ß: ",
        strengthLevels: ["√ßok zayƒ±f", "zayƒ±f", "orta", "g√º√ßl√º", "√ßok g√º√ßl√º"],
        welcome: "<strong>Easy Business'a Ho≈ü Geldiniz!</strong><br><br>Hesabƒ±nƒ±z onaylandƒ±. Artƒ±k e-posta adresiniz ve olu≈üturduƒüunuz ≈üifre ile giri≈ü yapabilirsiniz.",
        errorToken: "üö´ Hata: davet baƒülantƒ±sƒ± ge√ßersiz veya s√ºresi dolmu≈ü.",
        errorMatch: "üîí ≈ûifreler e≈üle≈ümiyor",
        reqTitle: "≈ûifre Gereksinimleri",
        reqLength: "8+ karakter", reqLatin: "Latin harf", reqNumber: "Rakam", reqSpecial: "√ñzel karakter"
      }
    };

    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    let currentLang = 'ru';

    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirmPassword');
    const submitBtn = document.getElementById('submitBtn');
    const buttonText = document.getElementById('buttonText');
    const spinner = document.getElementById('spinner');
    const resultMessage = document.getElementById('resultMessage');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');

    document.getElementById('languageToggle').onclick = (e) => {
      e.stopPropagation();
      document.getElementById('languageDropdown').classList.toggle('show');
    };

    document.querySelectorAll('.language-option').forEach(opt => {
      opt.onclick = () => {
        currentLang = opt.dataset.lang;
        updateLanguage();
        document.getElementById('languageDropdown').classList.remove('show');
      };
    });

    function updateLanguage() {
      const t = texts[currentLang];
      document.getElementById('title').innerHTML = t.title;
      document.getElementById('description').innerHTML = t.description;
      passwordInput.placeholder = t.passwordPlaceholder;
      confirmInput.placeholder = t.confirmPlaceholder;
      buttonText.innerText = t.buttonText;
      document.getElementById('currentLanguage').innerText = currentLang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : currentLang === 'en' ? 'English' : 'T√ºrk√ße';
      document.getElementById('reqTitle').innerHTML = `<i class="fas fa-shield-alt"></i> ${t.reqTitle}`;
      document.getElementById('req-length').querySelector('span').innerText = t.reqLength;
      document.getElementById('req-latin').querySelector('span').innerText = t.reqLatin;
      document.getElementById('req-number').querySelector('span').innerText = t.reqNumber;
      document.getElementById('req-special').querySelector('span').innerText = t.reqSpecial;
      updatePasswordStrength();
    }

    document.querySelectorAll('.toggle-password').forEach(btn => {
      btn.onclick = () => {
        const input = document.getElementById(btn.dataset.target);
        input.type = input.type === 'password' ? 'text' : 'password';
        btn.innerHTML = `<i class="fas fa-${input.type === 'password' ? 'eye' : 'eye-slash'}"></i>`;
      };
    });

    passwordInput.oninput = () => {
      const val = passwordInput.value;
      const checks = {
        length: val.length >= 8,
        latin: /[a-zA-Z]/.test(val),
        number: /[0-9]/.test(val),
        special: /[^A-Za-z0-9]/.test(val)
      };

      let score = 0;
      Object.keys(checks).forEach(key => {
        const el = document.getElementById(`req-${key}`);
        if (checks[key]) {
          el.classList.add('requirement-met');
          el.querySelector('i').className = 'fas fa-check-circle requirement-icon';
          score++;
        } else {
          el.classList.remove('requirement-met');
          el.querySelector('i').className = 'fas fa-circle requirement-icon';
        }
      });

      const strength = (score / 4) * 100;
      strengthFill.style.width = strength + '%';
      strengthFill.style.background = strength < 50 ? '#ef4444' : strength < 100 ? '#fbbf24' : '#10b981';
      const level = Math.floor((score / 4) * (texts[currentLang].strengthLevels.length - 1));
      strengthText.innerHTML = `${texts[currentLang].strengthText} <span style="color:${strengthFill.style.background}">${texts[currentLang].strengthLevels[level]}</span>`;
      
      submitBtn.disabled = !(score === 4 && val === confirmInput.value);
    };

    confirmInput.oninput = passwordInput.oninput;

    submitBtn.onclick = async () => {
      if (!token) {
        resultMessage.className = 'result-message error';
        resultMessage.innerText = texts[currentLang].errorToken;
        return;
      }

      buttonText.style.display = 'none';
      spinner.style.display = 'block';
      submitBtn.disabled = true;

      try {
        const res = await fetch('https://peewlvlbbiywjfjoawew.supabase.co/functions/v1/accept_invite', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, password: passwordInput.value })
        });

        const data = await res.json();

        if (res.ok) {
          resultMessage.className = 'result-message success';
          resultMessage.innerHTML = texts[currentLang].welcome;
          submitBtn.style.display = 'none';
          document.querySelector('.input-group').parentElement.querySelectorAll('.input-group, .password-strength, .password-requirements').forEach(el => el.style.display = 'none');
        } else {
          throw new Error(data.error || texts[currentLang].errorToken);
        }
      } catch (err) {
        resultMessage.className = 'result-message error';
        resultMessage.innerText = err.message;
        buttonText.style.display = 'block';
        spinner.style.display = 'none';
        submitBtn.disabled = false;
      }
    };

    window.onclick = () => document.getElementById('languageDropdown').classList.remove('show');
    updateLanguage();
  </script>
</body>
</html>
